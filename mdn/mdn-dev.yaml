#generated with `helm install --dry-run --debug kuma`
#from a local checkout of https://github.com/mdn/helm-charts
#then modified for mdn-dev

#Created tunnel using local port: '36145'
#SERVER: "localhost:36145"
#CHART PATH: /home/jgmize/src/mozilla/mdn/helm-charts/kuma
#NAME:   ringed-lizzard
#REVISION: 1
#RELEASED: Wed Apr 19 21:40:54 2017
#CHART: kuma-0.1.0
#USER-SUPPLIED VALUES:
#{}

#COMPUTED VALUES:
#allowed_hosts: '*'
#args:
#- -w=4
#- --bind=0.0.0.0
#- --access-logfile=-
#- --timeout=120
#- kuma.wsgi:application
#command: gunicorn
#debug: "False"
#debug_toolbar: "False"
#image:
#  pullPolicy: IfNotPresent
#  repository: quay.io/mozmar/kuma
#  tag: latest
#livenessProbe:
#  httpGet:
#    path: /contribute.json
#    port: 8000
#  initialDelaySeconds: 20
#  periodSeconds: 3
#maintenance_mode: "False"
#readinessProbe:
#  httpGet:
#    path: /en-US
#    port: 8000
#  initialDelaySeconds: 20
#  periodSeconds: 3
#replicaCount: 1
#resources:
#  requests:
#    cpu: 100m
#    memory: 256Mi
#service:
#  enable: true
#  externalPort: 80
#  internalPort: 8000
#  type: ClusterIP
#
#HOOKS:
#MANIFEST:

---
# Source: kuma/templates/service.yaml

apiVersion: v1
kind: Service
metadata:
  name: kuma
  labels:
    chart: "kuma-0.1.0"
spec:
  type: ClusterIP
  selector:
    app: kuma
  ports:
    - port: 80
      targetPort: 8000
      protocol: TCP


---
# Source: kuma/templates/deployment.yaml
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: mdn-dev
  name: mdn-dev
  namespace: mdn-dev
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: kuma
    spec:
      containers:
        - name: kuma
          image: "quay.io/mozmar/kuma:8426688"
          imagePullPolicy: IfNotPresent
          command:
            - "gunicorn"
          args:
            - "-w=4"
            - "--bind=0.0.0.0"
            - "--access-logfile=-"
            - "--timeout=120"
            - "kuma.wsgi:application"
          ports:
            - containerPort: 8000
          env:
            # Django settings overrides:
            - name: ACCOUNT_DEFAULT_HTTP_PROTOCOL
              value: http
            - name: ALLOWED_HOSTS
              value: "*"
            - name: BROKER_URL
              value: redis://redis:6379/0
            - name: CELERY_ALWAYS_EAGER
              value: "False"
            - name: CSRF_COOKIE_SECURE
              value: "False"
            - name: DATABASE_URL
              value: mysql://root:kuma@mysql:3306/developer_mozilla_org
            - name: DEBUG
              value: "False"
            - name: DEBUG_TOOLBAR
              value: "False"
            - name: DOMAIN
              value: kuma
            - name: ES_URLS
              value: elasticsearch:9200
            - name: KUMASCRIPT_URL_TEMPLATE
              value: http://kumascript:9080/docs/{path}
            - name: MEMCACHE_SERVERS
              value: memcached:11211
            - name: PROD_DETAILS_DIR
              value: /app/product_details_json
            - name: PROTOCOL
              value: "http://"
            - name: SESSION_COOKIE_SECURE
              value: "False"
            - name: SITE_URL
              value: http://kuma
            # Other environment overrides
            - name: PYTHONDONTWRITEBYTECODE
              value: "1"
            - name: PYTHONUNBUFFERED
              value: "True"
            - name: WEB_CONCURRENCY
              value: "4"
            - name: MAINTENANCE_MODE
              value: "False"
          livenessProbe:
            httpGet:
              path: /contribute.json
              port: 8000
            initialDelaySeconds: 20
            periodSeconds: 3
            
          readinessProbe:
            httpGet:
              path: /en-US
              port: 8000
            initialDelaySeconds: 20
            periodSeconds: 3
            
          resources:
            requests:
              cpu: 100m
              memory: 256Mi
            
